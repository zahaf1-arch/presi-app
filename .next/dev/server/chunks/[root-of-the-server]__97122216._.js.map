{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///D:/ELECTION/SiteRAG/presiapp/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = global as unknown as { prisma: PrismaClient }\n\nexport const prisma =\n  globalForPrisma.prisma ||\n  new PrismaClient({\n    log: ['query'],\n  })\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AAEC,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK;QAAC;KAAQ;AAChB;AAEF,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 93, "column": 0}, "map": {"version":3,"sources":["file:///D:/ELECTION/SiteRAG/presiapp/app/api/users/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\nimport { prisma } from \"@/lib/prisma\"\nimport jwt from \"jsonwebtoken\"\nimport bcrypt from \"bcryptjs\"\n\nexport async function GET(request: NextRequest) {\n  try {\n    const token = request.cookies.get(\"token\")?.value\n    if (!token) return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\n\n    const decoded: any = jwt.verify(token, process.env.JWT_SECRET!)\n    if (decoded.role?.toLowerCase() !== \"admin\")\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 })\n\n    const users = await prisma.user.findMany({\n      include: { wilaya: true },\n      orderBy: { createdAt: \"desc\" },\n    })\n\n    return NextResponse.json(users)\n  } catch (e) {\n    console.error(\"GET /api/users error:\", e)\n    return NextResponse.json({ error: \"Server error\" }, { status: 500 })\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const token = request.cookies.get(\"token\")?.value\n    if (!token) return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\n\n    const decoded: any = jwt.verify(token, process.env.JWT_SECRET!)\n    if (decoded.role?.toLowerCase() !== \"admin\")\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 })\n\n    const { name, email, role, wilaya_id } = await request.json()\n\n    const tempPassword = Math.random().toString(36).slice(2, 10).toUpperCase()\n\nconst hashed = await bcrypt.hash(tempPassword, 10)\n\nconst normalizedRole = role.toUpperCase()\n\nconst user = await prisma.user.create({\n  data: {\n    name,\n    email,\n    role: normalizedRole,\n    password: hashed,\n    mustChangePassword: true,\n    wilayaId: normalizedRole === \"OPERATOR\"\n      ? Number(wilaya_id)\n      : null,\n  },\n  include: { wilaya: true },\n})\n\nreturn NextResponse.json({\n  ...user,\n  tempPassword, // ✅ renvoyé UNE SEULE FOIS à l’admin\n}, { status: 201 })\n\n  } catch (error: any) {\n    console.error(\"POST /api/users error:\", error)\n\n    if (error.code === \"P2002\") {\n      return NextResponse.json({ error: \"Email already exists\" }, { status: 409 })\n    }\n\n    return NextResponse.json({ error: \"Failed to create user\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,UAAU;QAC5C,IAAI,CAAC,OAAO,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;QAE9E,MAAM,UAAe,kJAAG,CAAC,MAAM,CAAC,OAAO,QAAQ,GAAG,CAAC,UAAU;QAC7D,IAAI,QAAQ,IAAI,EAAE,kBAAkB,SAClC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAY,GAAG;YAAE,QAAQ;QAAI;QAEjE,MAAM,QAAQ,MAAM,yHAAM,CAAC,IAAI,CAAC,QAAQ,CAAC;YACvC,SAAS;gBAAE,QAAQ;YAAK;YACxB,SAAS;gBAAE,WAAW;YAAO;QAC/B;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,GAAG;QACV,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACpE;AACF;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,UAAU;QAC5C,IAAI,CAAC,OAAO,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;QAE9E,MAAM,UAAe,kJAAG,CAAC,MAAM,CAAC,OAAO,QAAQ,GAAG,CAAC,UAAU;QAC7D,IAAI,QAAQ,IAAI,EAAE,kBAAkB,SAClC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAY,GAAG;YAAE,QAAQ;QAAI;QAEjE,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,EAAE,SAAS,EAAE,GAAG,MAAM,QAAQ,IAAI;QAE3D,MAAM,eAAe,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,KAAK,CAAC,GAAG,IAAI,WAAW;QAE5E,MAAM,SAAS,MAAM,8IAAM,CAAC,IAAI,CAAC,cAAc;QAE/C,MAAM,iBAAiB,KAAK,WAAW;QAEvC,MAAM,OAAO,MAAM,yHAAM,CAAC,IAAI,CAAC,MAAM,CAAC;YACpC,MAAM;gBACJ;gBACA;gBACA,MAAM;gBACN,UAAU;gBACV,oBAAoB;gBACpB,UAAU,mBAAmB,aACzB,OAAO,aACP;YACN;YACA,SAAS;gBAAE,QAAQ;YAAK;QAC1B;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,GAAG,IAAI;YACP;QACF,GAAG;YAAE,QAAQ;QAAI;IAEf,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,0BAA0B;QAExC,IAAI,MAAM,IAAI,KAAK,SAAS;YAC1B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAuB,GAAG;gBAAE,QAAQ;YAAI;QAC5E;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF"}}]
}