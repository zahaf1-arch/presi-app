{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///D:/ELECTION/application/pr%C3%A9sidentille/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = global as unknown as { prisma: PrismaClient }\n\nexport const prisma =\n  globalForPrisma.prisma ||\n  new PrismaClient({\n    log: ['query'],\n  })\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AAEC,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK;QAAC;KAAQ;AAChB;AAEF,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 93, "column": 0}, "map": {"version":3,"sources":["file:///D:/ELECTION/application/pr%C3%A9sidentille/app/api/resultats/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { prisma } from '@/lib/prisma'\nimport jwt from 'jsonwebtoken'\n\nexport async function GET(request: NextRequest) {\n  try {\n   // const token = request.headers.get('authorization')?.split(' ')[1]\n    const token = request.cookies.get(\"token\")?.value\n    const { searchParams } = new URL(request.url)\n    const electionId = searchParams.get('electionId')\n\n    if (!token) {\n      return NextResponse.json(\n        { error: 'Unauthorized' },\n        { status: 401 }\n      )\n    }\n\n    const resultats = await prisma.resultat.findMany({\n      where: {\n        electionTypeId: electionId ? parseInt(electionId) : undefined,\n      },\n      include: {\n        bureau: {\n          include: {\n            centre: {\n              include: {\n                commune: {\n                  include: {\n                    moughataa: {\n                      include: {\n                        wilaya: true,\n                      },\n                    },\n                  },\n                },\n              },\n            },\n          },\n        },\n        candidat: true,\n        electionType: true,\n      },\n    })\n\n    return NextResponse.json(resultats)\n  } catch (error) {\n    console.error('Get resultats error:', error)\n    return NextResponse.json(\n      { error: 'Failed to fetch results' },\n      { status: 500 }\n    )\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n   // const token = request.headers.get('authorization')?.split(' ')[1]\n    const token = request.cookies.get(\"token\")?.value\n    if (!token) return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\n\n    const decoded: any = jwt.verify(token, process.env.JWT_SECRET!)\n\n    if (decoded.role === \"guest\")\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 })\n\n    const payload = await request.json()   // on re√ßoit bien un TABLEAU []\n\n    // Enregistre chaque candidat du bureau\n    for (const r of payload) {\n      await prisma.resultat.upsert({\n        where: { unique_result: { electionTypeId: r.electionTypeId, bureauId: r.bureauId, candidatId: r.candidatId }},\n        update: { nombreVoix: r.nombreVoix, voixNuls: r.voixNuls, voixRejetes: r.voixRejetes },\n        create: r,\n      })\n    }\n\n    return NextResponse.json({ success: true }, { status: 201 })\n\n  } catch (error) {\n    console.error(\"Create resultats error:\", error)\n    return NextResponse.json({ error: \"Failed to save results\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACH,oEAAoE;QACnE,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,UAAU;QAC5C,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,aAAa,aAAa,GAAG,CAAC;QAEpC,IAAI,CAAC,OAAO;YACV,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAe,GACxB;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,YAAY,MAAM,yHAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC;YAC/C,OAAO;gBACL,gBAAgB,aAAa,SAAS,cAAc;YACtD;YACA,SAAS;gBACP,QAAQ;oBACN,SAAS;wBACP,QAAQ;4BACN,SAAS;gCACP,SAAS;oCACP,SAAS;wCACP,WAAW;4CACT,SAAS;gDACP,QAAQ;4CACV;wCACF;oCACF;gCACF;4BACF;wBACF;oBACF;gBACF;gBACA,UAAU;gBACV,cAAc;YAChB;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA0B,GACnC;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACH,oEAAoE;QACnE,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,UAAU;QAC5C,IAAI,CAAC,OAAO,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;QAE9E,MAAM,UAAe,kJAAG,CAAC,MAAM,CAAC,OAAO,QAAQ,GAAG,CAAC,UAAU;QAE7D,IAAI,QAAQ,IAAI,KAAK,SACnB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAY,GAAG;YAAE,QAAQ;QAAI;QAEjE,MAAM,UAAU,MAAM,QAAQ,IAAI,GAAK,+BAA+B;;QAEtE,uCAAuC;QACvC,KAAK,MAAM,KAAK,QAAS;YACvB,MAAM,yHAAM,CAAC,QAAQ,CAAC,MAAM,CAAC;gBAC3B,OAAO;oBAAE,eAAe;wBAAE,gBAAgB,EAAE,cAAc;wBAAE,UAAU,EAAE,QAAQ;wBAAE,YAAY,EAAE,UAAU;oBAAC;gBAAC;gBAC5G,QAAQ;oBAAE,YAAY,EAAE,UAAU;oBAAE,UAAU,EAAE,QAAQ;oBAAE,aAAa,EAAE,WAAW;gBAAC;gBACrF,QAAQ;YACV;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK,GAAG;YAAE,QAAQ;QAAI;IAE5D,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAyB,GAAG;YAAE,QAAQ;QAAI;IAC9E;AACF"}}]
}