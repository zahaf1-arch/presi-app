{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///D:/ELECTION/application/pr%C3%A9sidentille/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = global as unknown as { prisma: PrismaClient }\n\nexport const prisma =\n  globalForPrisma.prisma ||\n  new PrismaClient({\n    log: ['query'],\n  })\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AAEC,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK;QAAC;KAAQ;AAChB;AAEF,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 93, "column": 0}, "map": {"version":3,"sources":["file:///D:/ELECTION/application/pr%C3%A9sidentille/app/api/auth/change-password/%5Bid%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\r\nimport { prisma } from \"@/lib/prisma\"\r\nimport bcrypt from \"bcryptjs\"\r\nimport jwt from \"jsonwebtoken\"\r\n\r\nexport async function POST(\r\n  req: NextRequest,\r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  const { id } = await params\r\n  const userId = Number(id)\r\n\r\n  const token = req.cookies.get(\"token\")?.value\r\n  if (!token) {\r\n    return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\r\n  }\r\n\r\n  const decoded: any = jwt.verify(token, process.env.JWT_SECRET!)\r\n\r\n  const isAdmin = decoded.role?.toLowerCase() === \"admin\"\r\n  const isSelf = decoded.id === userId\r\n\r\n  if (!isAdmin && !isSelf) {\r\n    return NextResponse.json({ error: \"Forbidden\" }, { status: 403 })\r\n  }\r\n\r\n  const { oldPassword, newPassword } = await req.json()\r\n\r\n  const user = await prisma.user.findUnique({ where: { id: userId } })\r\n  if (!user) {\r\n    return NextResponse.json({ error: \"Not found\" }, { status: 404 })\r\n  }\r\n\r\n  if (!isAdmin) {\r\n    const ok = await bcrypt.compare(oldPassword, user.password)\r\n    if (!ok) {\r\n      return NextResponse.json({ error: \"Invalid password\" }, { status: 400 })\r\n    }\r\n  }\r\n\r\n  const hashed = await bcrypt.hash(newPassword, 10)\r\n\r\n  await prisma.user.update({\r\n    where: { id: userId },\r\n    data: {\r\n      password: hashed,\r\n      mustChangePassword: false,\r\n    },\r\n  })\r\n\r\n  // ðŸ”¥ DÃ‰CONNEXION FORCÃ‰E\r\n  const res = NextResponse.json({ success: true })\r\n\r\n  res.cookies.set(\"token\", \"\", {\r\n    httpOnly: true,\r\n    path: \"/\",\r\n    maxAge: 0,\r\n  })\r\n\r\n  return res\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe,KACpB,GAAgB,EAChB,EAAE,MAAM,EAAuC;IAE/C,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;IACrB,MAAM,SAAS,OAAO;IAEtB,MAAM,QAAQ,IAAI,OAAO,CAAC,GAAG,CAAC,UAAU;IACxC,IAAI,CAAC,OAAO;QACV,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACpE;IAEA,MAAM,UAAe,kJAAG,CAAC,MAAM,CAAC,OAAO,QAAQ,GAAG,CAAC,UAAU;IAE7D,MAAM,UAAU,QAAQ,IAAI,EAAE,kBAAkB;IAChD,MAAM,SAAS,QAAQ,EAAE,KAAK;IAE9B,IAAI,CAAC,WAAW,CAAC,QAAQ;QACvB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAY,GAAG;YAAE,QAAQ;QAAI;IACjE;IAEA,MAAM,EAAE,WAAW,EAAE,WAAW,EAAE,GAAG,MAAM,IAAI,IAAI;IAEnD,MAAM,OAAO,MAAM,yHAAM,CAAC,IAAI,CAAC,UAAU,CAAC;QAAE,OAAO;YAAE,IAAI;QAAO;IAAE;IAClE,IAAI,CAAC,MAAM;QACT,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAY,GAAG;YAAE,QAAQ;QAAI;IACjE;IAEA,IAAI,CAAC,SAAS;QACZ,MAAM,KAAK,MAAM,8IAAM,CAAC,OAAO,CAAC,aAAa,KAAK,QAAQ;QAC1D,IAAI,CAAC,IAAI;YACP,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAmB,GAAG;gBAAE,QAAQ;YAAI;QACxE;IACF;IAEA,MAAM,SAAS,MAAM,8IAAM,CAAC,IAAI,CAAC,aAAa;IAE9C,MAAM,yHAAM,CAAC,IAAI,CAAC,MAAM,CAAC;QACvB,OAAO;YAAE,IAAI;QAAO;QACpB,MAAM;YACJ,UAAU;YACV,oBAAoB;QACtB;IACF;IAEA,wBAAwB;IACxB,MAAM,MAAM,gJAAY,CAAC,IAAI,CAAC;QAAE,SAAS;IAAK;IAE9C,IAAI,OAAO,CAAC,GAAG,CAAC,SAAS,IAAI;QAC3B,UAAU;QACV,MAAM;QACN,QAAQ;IACV;IAEA,OAAO;AACT"}}]
}