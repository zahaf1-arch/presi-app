{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///D:/ELECTION/SiteRAG/presiapp/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = global as unknown as { prisma: PrismaClient }\n\nexport const prisma =\n  globalForPrisma.prisma ||\n  new PrismaClient({\n    log: ['query'],\n  })\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AAEC,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK;QAAC;KAAQ;AAChB;AAEF,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 69, "column": 0}, "map": {"version":3,"sources":["file:///D:/ELECTION/SiteRAG/presiapp/app/api/geo/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\r\nimport { prisma } from \"@/lib/prisma\"\r\n\r\nexport async function GET(req: Request) {\r\n  try {\r\n    const { searchParams } = new URL(req.url)\r\n    const lang = searchParams.get(\"lang\") || \"fr\"\r\n    const isArabic = lang === \"ar\"\r\n\r\n    const wilayas = await prisma.wilaya.findMany({\r\n      include: {\r\n        moughataas: {\r\n          include: {\r\n            communes: {\r\n              include: {\r\n                centres: {\r\n                  include: {\r\n                    bureaux: {\r\n                      include: {\r\n                        resultats: {\r\n                          include: {\r\n                            candidat: true,\r\n                            electionType: true,\r\n                          },\r\n                        },\r\n                      },\r\n                    },\r\n                  },\r\n                },\r\n              },\r\n            },\r\n          },\r\n        },\r\n      },\r\n      orderBy: { nom_fr: \"asc\" },\r\n    })\r\n\r\n    const wilayasWithStats = wilayas.map((w) => {\r\n      const moughataas = Array.isArray(w.moughataas) ? w.moughataas : []\r\n\r\n      const mappedMoughataas = moughataas.map((m) => {\r\n        const communes = Array.isArray(m.communes) ? m.communes : []\r\n\r\n        const mappedCommunes = communes.map((c) => {\r\n          const centres = Array.isArray(c.centres) ? c.centres : []\r\n\r\n          const mappedCentres = centres.map((ctr) => {\r\n            const bureaux = Array.isArray(ctr.bureaux) ? ctr.bureaux : []\r\n\r\n            const mappedBureaux = bureaux.map((b) => {\r\n              const resultats = Array.isArray(b.resultats) ? b.resultats : []\r\n\r\n              const totalInscrits = b.nombreInscrits ?? 0\r\n              const totalVotants = b.nombreVotants ?? 0\r\n\r\n              return {\r\n                id: b.id,\r\n                nom: isArabic ? b.nom_ar : b.nom_fr,\r\n                totalInscrits,\r\n                totalVotants,\r\n                tauxParticipation:\r\n                  totalInscrits > 0\r\n                    ? Math.round((totalVotants / totalInscrits) * 10000) / 100\r\n                    : 0,\r\n\r\n                resultats: resultats.map((r) => ({\r\n                  id: r.id,\r\n                  candidatId: r.candidatId,\r\n                  candidatNom: isArabic ? r.candidat.nom_ar : r.candidat.nom_fr,\r\n                  candidatCouleur: r.candidat.couleur,\r\n                  candidatLogo: r.candidat.logo,\r\n                  nombreVoix: r.nombreVoix ?? 0,\r\n                  voixNuls: r.voixNuls ?? 0,\r\n                  voixRejetes: r.voixRejetes ?? 0,\r\n                  electionType: isArabic\r\n                    ? r.electionType.nom_ar\r\n                    : r.electionType.nom_fr,\r\n                })),\r\n              }\r\n            })\r\n\r\n            const totalInscrits = mappedBureaux.reduce((s, x) => s + x.totalInscrits, 0)\r\n            const totalVotants = mappedBureaux.reduce((s, x) => s + x.totalVotants, 0)\r\n\r\n            return {\r\n              id: ctr.id,\r\n              nom: isArabic ? ctr.nom_ar : ctr.nom_fr,\r\n              bureaux: mappedBureaux,\r\n              totalInscrits,\r\n              totalVotants,\r\n              tauxParticipation:\r\n                totalInscrits > 0\r\n                  ? Math.round((totalVotants / totalInscrits) * 10000) / 100\r\n                  : 0,\r\n            }\r\n          })\r\n\r\n          const totalInscrits = mappedCentres.reduce((s, x) => s + x.totalInscrits, 0)\r\n          const totalVotants = mappedCentres.reduce((s, x) => s + x.totalVotants, 0)\r\n\r\n          return {\r\n            id: c.id,\r\n            nom: isArabic ? c.nom_ar : c.nom_fr,\r\n            centres: mappedCentres,\r\n            totalInscrits,\r\n            totalVotants,\r\n            tauxParticipation:\r\n              totalInscrits > 0\r\n                ? Math.round((totalVotants / totalInscrits) * 10000) / 100\r\n                : 0,\r\n          }\r\n        })\r\n\r\n        const totalInscrits = mappedCommunes.reduce((s, x) => s + x.totalInscrits, 0)\r\n        const totalVotants = mappedCommunes.reduce((s, x) => s + x.totalVotants, 0)\r\n\r\n        return {\r\n          id: m.id,\r\n          nom: isArabic ? m.nom_ar : m.nom_fr,\r\n          communes: mappedCommunes,\r\n          totalInscrits,\r\n          totalVotants,\r\n          tauxParticipation:\r\n            totalInscrits > 0\r\n              ? Math.round((totalVotants / totalInscrits) * 10000) / 100\r\n              : 0,\r\n        }\r\n      })\r\n\r\n      const totalInscrits = mappedMoughataas.reduce((s, x) => s + x.totalInscrits, 0)\r\n      const totalVotants = mappedMoughataas.reduce((s, x) => s + x.totalVotants, 0)\r\n\r\n      return {\r\n        id: w.id,\r\n        nom: isArabic ? w.nom_ar : w.nom_fr,\r\n        moughataas: mappedMoughataas,\r\n        totalInscrits,\r\n        totalVotants,\r\n        tauxParticipation:\r\n          totalInscrits > 0\r\n            ? Math.round((totalVotants / totalInscrits) * 10000) / 100\r\n            : 0,\r\n      }\r\n    })\r\n\r\n    return NextResponse.json(wilayasWithStats)\r\n  } catch (error) {\r\n    console.error(\"Erreur chargement géographie:\", error)\r\n    return NextResponse.json(\r\n      { error: \"Erreur de chargement des données\" },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}