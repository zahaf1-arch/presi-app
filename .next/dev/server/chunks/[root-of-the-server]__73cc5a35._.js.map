{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///D:/ELECTION/SiteRAG/presiapp/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = global as unknown as { prisma: PrismaClient }\n\nexport const prisma =\n  globalForPrisma.prisma ||\n  new PrismaClient({\n    log: ['query'],\n  })\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AAEC,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK;QAAC;KAAQ;AAChB;AAEF,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 93, "column": 0}, "map": {"version":3,"sources":["file:///D:/ELECTION/SiteRAG/presiapp/app/api/auth/login/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\nimport { prisma } from \"@/lib/prisma\"\nimport bcrypt from \"bcryptjs\"\nimport jwt from \"jsonwebtoken\"\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { email, password } = await request.json()\n\n    const user = await prisma.user.findUnique({\n      where: { email },\n      include: { wilaya: true },\n    })\n\n    if (!user) {\n      return NextResponse.json({ error: \"Invalid credentials\" }, { status: 401 })\n    }\n\n    const valid = await bcrypt.compare(password, user.password)\n    if (!valid) {\n      return NextResponse.json({ error: \"Invalid credentials\" }, { status: 401 })\n    }\n\n     const token = jwt.sign(\n  {\n    id: user.id,\n    role: user.role,\n    wilayaId: user.wilayaId,\n    mustChangePassword:\n      user.role !== \"ADMIN\" && user.mustChangePassword,\n  },\n  process.env.JWT_SECRET!,\n  { expiresIn: \"30m\" }\n)\n\n    const res = NextResponse.json({ \n      token,\n      user \n    })\n\n    res.cookies.set(\"token\", token, {\n      httpOnly: true,\n      sameSite: \"lax\",\n      secure: process.env.NODE_ENV === \"production\", // ðŸ”¥ IMPORTANT\n      path: \"/\",\n      maxAge: 600,\n    })\n\n    return res\n  } catch (e) {\n\n  console.error(\"LOGIN ERROR ðŸ‘‰\", e)\n  return NextResponse.json({ error: \"Server error\" }, { status: 500 })\n}\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,MAAM,QAAQ,IAAI;QAE9C,MAAM,OAAO,MAAM,yHAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YACxC,OAAO;gBAAE;YAAM;YACf,SAAS;gBAAE,QAAQ;YAAK;QAC1B;QAEA,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAC3E;QAEA,MAAM,QAAQ,MAAM,8IAAM,CAAC,OAAO,CAAC,UAAU,KAAK,QAAQ;QAC1D,IAAI,CAAC,OAAO;YACV,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAC3E;QAEC,MAAM,QAAQ,kJAAG,CAAC,IAAI,CACzB;YACE,IAAI,KAAK,EAAE;YACX,MAAM,KAAK,IAAI;YACf,UAAU,KAAK,QAAQ;YACvB,oBACE,KAAK,IAAI,KAAK,WAAW,KAAK,kBAAkB;QACpD,GACA,QAAQ,GAAG,CAAC,UAAU,EACtB;YAAE,WAAW;QAAM;QAGjB,MAAM,MAAM,gJAAY,CAAC,IAAI,CAAC;YAC5B;YACA;QACF;QAEA,IAAI,OAAO,CAAC,GAAG,CAAC,SAAS,OAAO;YAC9B,UAAU;YACV,UAAU;YACV,QAAQ,oDAAyB;YACjC,MAAM;YACN,QAAQ;QACV;QAEA,OAAO;IACT,EAAE,OAAO,GAAG;QAEZ,QAAQ,KAAK,CAAC,kBAAkB;QAChC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACpE;AACA"}}]
}